# PDF裁切可视化工具 - PyQt6版本

## 概述

这是一个基于PyQt6开发的现代化PDF裁切参数可视化调整工具，提供直观的图形界面，支持实时预览、智能分析、参数调整等功能。相比tkinter版本，PyQt版本具有更好的跨平台兼容性、更现代的界面设计和更丰富的功能。

## 主要特性

### 🎯 核心功能
- **可视化预览**: 实时显示PDF页面和裁切效果
- **智能分析**: 自动检测页眉页脚，建议最佳裁切参数
- **精确调整**: 支持像素级别的裁切参数调整
- **批量处理**: 一次性应用裁切到整个PDF文档
- **配置管理**: 保存和加载裁切配置，支持预设模板

### 🎨 界面特色
- **现代化设计**: 采用PyQt6构建，界面美观现代
- **响应式布局**: 自适应窗口大小，支持分割面板调整
- **实时反馈**: 参数调整时立即显示预览效果
- **多种控制方式**: 滑块、输入框、预设配置多种调整方式

### 🔧 高级功能
- **多线程分析**: 页面分析在后台进行，不阻塞界面
- **配置导入导出**: JSON格式配置文件，便于分享和备份
- **命令行支持**: 支持通过命令行参数直接加载PDF
- **错误处理**: 完善的异常处理和用户提示

## 安装要求

### 系统要求
- Python 3.7+
- macOS / Windows / Linux

### 依赖包
```bash
pip install PyQt6 PyMuPDF Pillow
```

或者使用项目的requirements.txt：
```bash
pip install -r requirements.txt
```

## 使用方法

### 启动应用

#### 方法1: 直接启动
```bash
python3 pdf_crop_pyqt.py
```

#### 方法2: 命令行加载PDF
```bash
python3 pdf_crop_pyqt.py "path/to/your/document.pdf"
```

### 基本操作流程

#### 1. 加载PDF文件
- 点击「📁 选择PDF文件」按钮
- 在文件对话框中选择要处理的PDF文件
- 文件加载后会显示第一页预览

#### 2. 页面导航
- 使用「⬅️ 上一页」和「➡️ 下一页」按钮浏览页面
- 页面信息显示当前页码和总页数

#### 3. 智能分析（推荐）
- 点击「🔍 分析当前页面」按钮
- 工具会自动检测页眉、页脚和建议裁切参数
- 勾选「自动应用分析结果」可自动应用建议参数

#### 4. 手动调整参数
- 使用滑块或输入框调整四个边距值
- 预览区域会实时显示裁切效果
- 点击「🔄 重置参数」可清零所有参数

#### 5. 使用预设配置
- 从下拉菜单选择预设配置：
  - **标准文档**: 上下各20px
  - **学术论文**: 上下各30px
  - **杂志文章**: 四周各15px
  - **扫描文档**: 四周各25px

#### 6. 预览和应用
- 点击「👁️ 预览裁切效果」确认效果
- 点击「✅ 应用并保存」生成裁切后的PDF

### 配置管理

#### 保存配置
1. 调整好裁切参数后
2. 点击「💾 保存配置」按钮
3. 选择保存位置和文件名
4. 配置将以JSON格式保存

#### 加载配置
1. 点击「📂 加载配置」按钮
2. 选择之前保存的配置文件
3. 参数会自动应用到界面

#### 配置文件格式
```json
{
  "pdf_crop": {
    "top": 30,
    "bottom": 30,
    "left": 0,
    "right": 0
  },
  "description": "使用PyQt工具生成的PDF裁切配置"
}
```

## 界面说明

### 左侧控制面板

#### 文件操作区
- **选择PDF文件**: 加载要处理的PDF文档
- **文件信息**: 显示当前文件名和页数

#### 页面导航区
- **上一页/下一页**: 浏览PDF页面
- **页面信息**: 显示当前页码

#### 智能分析区
- **分析当前页面**: 启动智能分析
- **自动应用分析结果**: 是否自动应用建议参数
- **进度条**: 显示分析进度

#### 裁切参数区
- **顶部/底部/左侧/右侧**: 四个边距调整控件
- **滑块**: 快速调整参数
- **输入框**: 精确输入数值
- **重置参数**: 清零所有参数

#### 预设配置区
- **预设选择**: 快速应用常用配置
- **保存/加载配置**: 配置文件管理

#### 操作区
- **预览裁切效果**: 更新预览显示
- **应用并保存**: 生成最终文件

#### 分析结果区
- 显示智能分析的详细结果
- 包括页面信息、检测到的页眉页脚、建议参数等

### 右侧预览区
- **PDF预览**: 显示当前页面
- **实时更新**: 参数调整时立即显示效果
- **缩放适应**: 自动缩放以适应显示区域
- **滚动支持**: 支持滚动查看大页面

## 高级功能

### 智能分析算法

工具使用先进的文本块分析算法：

1. **页面布局分析**: 识别文本块的位置和大小
2. **页眉检测**: 检测页面顶部的重复性内容
3. **页脚检测**: 检测页面底部的页码、版权等信息
4. **边距计算**: 基于内容分布计算最佳裁切参数

### 多线程处理

- 页面分析在后台线程中进行
- 界面保持响应，不会冻结
- 进度条显示分析状态

### 实时预览

- 参数调整时立即更新预览
- 高质量图像渲染（2倍缩放）
- 智能缩放以适应显示区域

## 与其他工具的集成

### 与翻译器集成

生成的配置文件可以直接用于PDF翻译器：

```python
# 在翻译器中使用
from pdf_translator import PDFTranslator

translator = PDFTranslator()
translator.load_config('crop_config.json')
translator.translate('document.pdf')
```

### 与命令行工具配合

可以与 `pdf_crop_cli.py` 配合使用：

1. 使用PyQt工具调整参数并保存配置
2. 使用命令行工具批量处理多个文件

## 故障排除

### 常见问题

#### 1. 界面显示异常
**问题**: 界面元素显示不正常或布局错乱
**解决**: 
- 确保PyQt6版本 >= 6.5.0
- 尝试重启应用
- 检查系统显示缩放设置

#### 2. PDF加载失败
**问题**: 无法打开某些PDF文件
**解决**:
- 确保PDF文件未损坏
- 检查文件是否被其他程序占用
- 尝试使用其他PDF查看器验证文件

#### 3. 分析功能无响应
**问题**: 点击分析按钮后无反应
**解决**:
- 等待分析完成（复杂页面可能需要较长时间）
- 检查控制台是否有错误信息
- 尝试分析其他页面

#### 4. 预览图像模糊
**问题**: PDF预览图像不清晰
**解决**:
- 工具使用2倍缩放渲染，应该足够清晰
- 检查原始PDF的质量
- 尝试调整窗口大小

### 性能优化

#### 大文件处理
- 工具逐页加载，内存占用较低
- 分析功能使用多线程，不阻塞界面
- 建议处理超大文件时关闭实时预览

#### 系统资源
- 正常使用下内存占用 < 200MB
- CPU使用率在分析时会短暂升高
- 建议在SSD上运行以提高响应速度

## 开发信息

### 技术栈
- **GUI框架**: PyQt6
- **PDF处理**: PyMuPDF (fitz)
- **图像处理**: Pillow
- **多线程**: QThread

### 代码结构
```
pdf_crop_pyqt.py
├── PDFCropPyQt (主窗口类)
├── PDFAnalysisThread (分析线程类)
├── UI组件创建方法
├── 事件处理方法
└── 工具函数
```

### 扩展开发

如需扩展功能，可以：

1. **添加新的预设配置**:
```python
presets = {
    "自定义预设": {'top': 40, 'bottom': 40, 'left': 10, 'right': 10}
}
```

2. **自定义分析算法**:
```python
def custom_analysis(self, page):
    # 实现自定义分析逻辑
    pass
```

3. **添加新的导出格式**:
```python
def export_to_format(self, format_type):
    # 实现新的导出格式
    pass
```

## 版本历史

### v1.0.0 (当前版本)
- ✅ 基础PDF裁切功能
- ✅ 智能分析算法
- ✅ 现代化PyQt6界面
- ✅ 配置管理系统
- ✅ 多线程处理
- ✅ 实时预览功能

### 计划功能
- 🔄 批量文件处理
- 🔄 更多预设模板
- 🔄 OCR文本识别
- 🔄 PDF合并分割

## 许可证

本工具作为PDF翻译器项目的一部分，遵循项目的开源许可证。

## 支持

如有问题或建议，请：
1. 检查本文档的故障排除部分
2. 查看项目的GitHub Issues
3. 提交新的Issue描述问题

---

**享受使用PyQt版本的PDF裁切工具！** 🎉